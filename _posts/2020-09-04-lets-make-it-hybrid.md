---
layout: post
title:  "----В РАЗРАБОТКЕ-------
Использование Azure для локальной инфраструктуры"
author: sergeype
tags: [ Azure, Automation, Arc, LogAnalytics, Updates, Monitoring ]
image: assets/users/sergeyperus/hybrid.png
featured: true
hidden: true
---

Итак, вы не используете облака, у вас все локально, ну максимум немного местного хостинга. 
Для Вас публичные облака - это пока непонятно, опасно, да еще и не нужно. Цель этой статьи - показать, какие преимущества Вы и Ваша локальная инфраструктура могут получить от использования облака Microsoft Azure. Я пошагово буду показывать все этапы, давать ссылки на документацию и объяснять стоимость (насколько это возможно)

Начну сразу с результатов:

1) Вы в реальном времени можете видеть метрики конкретного сервера или группы серверов, вне зависимости от их нахождения.
На любую метрику можем установить оповещение. Например, на диске меньше 80% свободного места

![Image](/assets/users/sergeyperus/vmperformance.gif)

2) Анализируется взаимодействие приложений и серверов друг с другом и с внешним миром. Сформирована динамичная карта сервисов. На выбранный промежуток времени Вы видите состояние всех компонентов приложения и проблемы, найденные у них. Например, неуспешное соединение, высокая загрузка ресурсов, проблемы с сетью или взаимодействие с вредоносными внешними ресурсами.

![Image](/assets/users/sergeyperus/servicemap.gif)

3) Вы видите, что происходит с сетями со стороны приложений - не только наличие/отсутствие соединения, но и его качество - задержки/потери в каждом сегменте, а так же путь сигнала

![Image](/assets/users/sergeyperus/networkperformance.gif)

4) Вы видите ситуацию с обновлениями - что уже установлено, а что только выпущено для Microsoft и Linux систем. Можете запланировать развертывание по группам серверов и критичности обновлений. Прописать pre- и post- скрипты. Отслеживать результат

![Image](/assets/users/sergeyperus/updatemanagement.gif)

5) Любые изменения в составе программного обеспечения, отдельных папок/файлов и веток реестра сразу видны администратору. Программная инвентаризация - дело нескольких секунд в любой момент

![Image](/assets/users/sergeyperus/inventory.gif)

6) Регулярно проводится проверка критичных компонентов (Active Directory и SQL сервера) на соответствие лучшим практикам Microsoft

![Image](/assets/users/sergeyperus/adsqlassessment.gif)

7) Есть прямой доступ ко всей базе накопленной информации. Можете искать централизовано любую информацию, строить отчеты и создавать оповещения о критичных, на Ваш взгляд, событиях

![Image](/assets/users/sergeyperus/loganalytics.gif)

8) Без каких-либо капитальных затрат события безопасности из всех используемых Вами систем анализируются на предмет предотвращения вторжений облачной SIEM. Настроены механизмы автоматизации для остановки потенциальных атак. Например, блокирование скомпрометированных учетных записей, создание тикета в поддержку. Каждый найденный инцидент собирает воедино всех участников (учетные записи/компьютеры/сети...) для упрощения анализа произошедшего и ликвидации последствий

![Image](/assets/users/sergeyperus/sentinel.gif)



# Этап первый: мониторинг


## Цель - получить информацию о состоянии систем:
  - обновления
  - метрики (CPU/MEM/Disk/Network) и прочие, в том числе специализированные (SQL/Exchange ...)
  - взаимодействие серверов друг с другом, проблемы участников
  - централизация хранения логов/системных журналов с возможностью поиска и анализа собранной информации

## Стоимость

Первые 5 ГБ собираемой и хранимой 30 дней информации каждый месяц - бесплатно. Далее - по тарифу 186 рублей за 1ГБ. Здесь и далее все цены я буду брать из [калькулятора Azure](https://azure.microsoft.com/en-us/pricing/calculator/). Подробнее про [ценообразование мониторинга ](https://docs.microsoft.com/ru-ru/azure/azure-monitor/platform/usage-estimated-costs)
До начала работы сервисы вы, скорей всего, не знаете - какой объем логов генерят сервера. Поэтому мы сразу ограничим ежедневный объем принимаемой информациию чтоб избежать лишних затрат.

## Реализация

1. Создадим [Рабочую Область](https://docs.microsoft.com/ru-ru/azure/azure-monitor/learn/quick-create-workspace) в регионе West Europe, например. Она будет использована для хранения данных, все остальные сервисы будут опираться на нее. Кроме того, мы сможем вручную посмотреть/поискать/анализировать накопленные данные

<!-- 

![Image](/assets/users/sergeyperus/createlaworkspace.gif)

## Network Performance Monitor 
https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor


















-->